<% content_for :custom_yield do %>
<%= render 'subhead' %>
<h5><%= @counter_party.name %></h5>
<p><%= @contract unless @contract.single? %></p>
<p><%= l start_date=Date.strptime(params[:all_flows][:start_date]) %> - <%= l Date.strptime(params[:all_flows][:end_date]) %></p>
<table class="table table-hover table-responsive table-bordered text-right">
	<thead>
		<tr>
		<% %w[type date opening_balance amount_up amount_down closing_balance].each do |column| %>
			<th><%= t "attributes.#{column}" %></th>
		<%end%>
		</tr>
	</thead>
	<tbody>

			<% closing = @counter_party.balance(start_date, @contract.id) || 0
				currency = @contract.currency %>
			<% @records.each do |record| %>
				
			<%= tag.tr 'data-url': url_for(only_path: true, controller: record['model'].pluralize, action: :show, id: record['id']) do %>
				<% record['model'] = %w[income expense][record['type_id']/10] if record['type_id'] %>
				<td><%=t record['model'] + '.one', scope: 'activerecord.models' %></td>
				<td><%=l(Date.strptime(record['datetime'])) %></td>
				<td><%= currency_precise_number(opening=closing, currency) %></td>
				<% amount = currency_precise_number record['amount'], currency %>
				<% if amount_down = record['model'].in?(%w[income purchase]) %>
					<td></td>
					<td><%= amount %></td>
				<%else%>
					<td><%= amount %></td>
					<td></td>
				<%end%>
				<td><%= currency_precise_number(
					closing=opening+(amount_down ? -record['amount'] : record['amount']), currency) %></td>
			<%end%>

			<%end%>

			<% if @records.blank? %>
				<tr>
					<td colspan="5">Bu muddat ichida xech nima topilmadi.</td>
					<td><%= currency_precise_number closing, @contract.currency %></td>
				</tr>
			<%end%>
			
	</tbody>
</table>
<%end%>