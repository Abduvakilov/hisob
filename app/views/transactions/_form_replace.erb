<% path = @transaction.persisted? ? transaction_path(@transaction) : transactions_path %>
<%= simple_form_for @transaction, url: path,
    html: { 'data-controller': 'replace' },
    defaults: { wrapper_html: { class: 'col-md' } } do |f| %>

  <%= f.error_notification %>
  
  <%= f.input :type_id, as: :hidden, input_html: {value: 20} %>

  <div class="form-row">
    <%= f.input :datetime, as: :datepicker, input_html: { data: {
      flatpickr_default_date: DateTime.now,
      flatpickr_enable_time: true,
      flatpickr_alt_format: t('datetime.formats.default')} } %>
    <%= f.input :amount, as: :currency %>
  </div>


  <div class="form-row">
    <%= f.association :account, as: :account, label: "Hisobdan",
      collection: Account.kept,
      selected: (@transaction.account_id ||= 1),
      wrapper_html: { 'data-controller': 'account' },
      input_html: { 'data-action': 'change->account#updateBalance',
                  'data-target': 'account.input' },
      balance: currency_precise_number(@transaction.account.balance, @transaction.account.currency, unit: true),
      balance_data_target: 'account.balance'
    %> <!-- TODO: Selected should be user default-->
    <%= f.association :counter_account, as: :account, label: "Hisobga",
      collection: Account.kept,
      wrapper_html: { 'data-controller': 'account' },
      input_html: { 'data-action': 'change->account#updateBalance',
                  'data-target': 'account.input' },
      balance: currency_precise_number(@transaction.counter_account&.balance, @transaction.counter_account&.currency, unit: true),
      balance_data_target: 'account.balance'
    %>
  </div>
  
  <%= more_wrapped 'replace' do %>
    <div class="form-row">
      <%= f.input :notes %>
    </div>
  <% end %>
  <%= render 'common/form_buttons', f: f %>
<% end %>